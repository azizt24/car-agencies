const agencies = [
  {
    agencyName: "Best Deal",
    cash: 1245000,
    credit: 200000,
    agencyId: "Plyq5M5AZ",

    cars: [
      {
        brand: "bmw",
        models: [
          {
            name: "3",
            year: 2015,
            price: 137000,
            carNumber: "AZJZ4",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "X6",
            year: 2020,
            price: 966500,
            carNumber: "S6DL1",
            ownerId: "Plyq5M5AZ",
          },
        ],
      },
      {
        brand: "toyota",
        models: [
          {
            name: "Land Cruiser",
            year: 2020,
            price: 336300,
            carNumber: "6rvXw",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Hilux",
            year: 2005,
            price: 35005,
            carNumber: "MWXBG",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Corolla",
            year: 2020,
            price: 111900,
            carNumber: "hCzl-",
            ownerId: "Plyq5M5AZ",
          },
        ],
      },
      {
        brand: "Ford",
        models: [
          {
            name: "Focus",
            year: 2020,
            price: 98200,
            carNumber: "kN3HP",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Focus",
            year: 2005,
            price: 6502,
            carNumber: "LJTCs",
            ownerId: "Plyq5M5AZ",
          },
        ],
      },
      {
        brand: "Alpha romeo",
        models: [
          {
            name: "Romeo Julia",
            year: 2020,
            price: 275406,
            carNumber: "2kjy7",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Romeo Stelvio",
            year: 2019,
            price: 215403,
            carNumber: "7A5b-",
            ownerId: "Plyq5M5AZ",
          },
        ],
      },
      {
        brand: "Chevrolet",
        models: [
          {
            name: "Traverse",
            year: 2020,
            price: 201102,
            carNumber: "QwBOT",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Impala",
            year: 2019,
            price: 165041,
            carNumber: "2v4jt",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Malibu",
            year: 2017,
            price: 75405,
            carNumber: "O4_Jv",
            ownerId: "Plyq5M5AZ",
          },
        ],
      },
    ],
  },
  {
    agencyName: "CarMax",
    cash: 968541,
    credit: 500000,
    agencyId: "26_IPfHU1",
    cars: [
      {
        brand: "bmw",
        models: [
          {
            name: "X5",
            year: 2015,
            price: 218000,
            carNumber: "4Ixb0",
            ownerId: "26_IPfHU1",
          },
          {
            name: "X6",
            year: 2014,
            price: 97100,
            carNumber: "kAnv-",
            ownerId: "26_IPfHU1",
          },
          {
            name: "Z4",
            year: 2019,
            price: 296900,
            carNumber: "ISMdU",
            ownerId: "26_IPfHU1",
          },
          {
            name: "3",
            year: 2010,
            price: 75100,
            carNumber: "9DJPw",
            ownerId: "26_IPfHU1",
          },
        ],
      },
      {
        brand: "toyota",
        models: [
          {
            name: "Land Cruiser",
            year: 2005,
            price: 80540,
            carNumber: "Kt-pW",
            ownerId: "26_IPfHU1",
          },
          {
            name: "Corolla",
            year: 2019,
            price: 109100,
            carNumber: "YiYdI",
            ownerId: "26_IPfHU1",
          },
          {
            name: "Hilux",
            year: 2019,
            price: 204000,
            carNumber: "DRmNw",
            ownerId: "26_IPfHU1",
          },
        ],
      },
      {
        brand: "Ford",
        models: [
          {
            name: "F250",
            year: 2020,
            price: 198500,
            carNumber: "g4Wfp",
            ownerId: "26_IPfHU1",
          },
          {
            name: "Explorer",
            year: 2020,
            price: 265200,
            carNumber: "iNT8Q",
            ownerId: "26_IPfHU1",
          },
        ],
      },
      {
        brand: "Alpha romeo",
        models: [
          {
            name: "Spider",
            year: 2011,
            price: 75405,
            carNumber: "6t7QU",
            ownerId: "26_IPfHU1",
          },
          {
            name: "166",
            year: 2002,
            price: 12400,
            carNumber: "XMqpn",
            ownerId: "26_IPfHU1",
          },
        ],
      },
      {
        brand: "Chevrolet",
        models: [
          {
            name: "Impala",
            year: 2016,
            price: 65042,
            carNumber: "vbeAo",
            ownerId: "26_IPfHU1",
          },
          {
            name: "Savannah",
            year: 2016,
            price: 76505,
            carNumber: "WelWa",
            ownerId: "26_IPfHU1",
          },
        ],
      },
    ],
  },
  {
    agencyName: "The Auto World",
    cash: 687450,
    credit: 200000,
    agencyId: "gNHjNFL12",
    cars: [
      {
        brand: "bmw",
        models: [
          {
            name: "X6",
            year: 2018,
            price: 548100,
            carNumber: "EMW_7",
            ownerId: "gNHjNFL12",
          },
          {
            name: "3",
            year: 2017,
            price: 178000,
            carNumber: "XlnB4",
            ownerId: "gNHjNFL12",
          },
        ],
      },
      {
        brand: "toyota",
        models: [
          {
            name: "Prius",
            year: 2017,
            price: 101542,
            carNumber: "-RQgN",
            ownerId: "gNHjNFL12",
          },
          {
            name: "Highlander",
            year: 2017,
            price: 202540,
            carNumber: "AZJZ4",
            ownerId: "gNHjNFL12",
          },
          {
            name: "Corolla",
            year: 1996,
            price: 5420,
            carNumber: "kHE8f",
            ownerId: "gNHjNFL12",
          },
          {
            name: "Corolla",
            year: 2012,
            price: 40570,
            carNumber: "p2qEi",
            ownerId: "gNHjNFL12",
          },
        ],
      },
      {
        brand: "Ford",
        models: [
          {
            name: "Explorer",
            year: 2014,
            price: 127502,
            carNumber: "Ty1zN",
            ownerId: "gNHjNFL12",
          },
          {
            name: "F350",
            year: 2012,
            price: 54250,
            carNumber: "z03H2",
            ownerId: "gNHjNFL12",
          },
        ],
      },
      {
        brand: "Chevrolet",
        models: [
          {
            name: "Savannah",
            year: 2010,
            price: 36504,
            carNumber: "RXFZe",
            ownerId: "gNHjNFL12",
          },
          {
            name: "Malibu",
            year: 2009,
            price: 19585,
            carNumber: "K5IsM",
            ownerId: "gNHjNFL12",
          },
        ],
      },
    ],
  },
  {
    agencyName: "Car Werks",
    cash: 302502,
    credit: 150000,
    agencyId: "9KeaYbRLP",
    cars: [
      {
        brand: "bmw",
        models: [
          {
            name: "8",
            year: 2020,
            price: 942500,
            carNumber: "4IUMz",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "X6",
            year: 2010,
            price: 129000,
            carNumber: "Vw0fV",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "X3",
            year: 2019,
            price: 358100,
            carNumber: "ufN54",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "3",
            year: 2020,
            price: 389100,
            carNumber: "F127X",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "3",
            year: 2002,
            price: 18400,
            carNumber: "ueZUp",
            ownerId: "9KeaYbRLP",
          },
        ],
      },
      {
        brand: "toyota",
        models: [
          {
            name: "Prius",
            year: 2011,
            price: 38520,
            carNumber: "AZJZ4",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "Land Cruiser",
            year: 2019,
            price: 290040,
            carNumber: "AZJZ4",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "Hilux",
            year: 2020,
            price: 215700,
            carNumber: "xig8N",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "Hilux",
            year: 2015,
            price: 178506,
            carNumber: "ghTiQ",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "Corolla",
            year: 2002,
            price: 8504,
            carNumber: "Mvw8T",
            ownerId: "9KeaYbRLP",
          },
        ],
      },
      {
        brand: "Chevrolet",
        models: [
          {
            name: "Impala",
            year: 2005,
            price: 9320,
            carNumber: "BZpkt",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "Malibu",
            year: 2002,
            price: 4502,
            carNumber: "KqKV_",
            ownerId: "9KeaYbRLP",
          },
        ],
      },
    ],
  },
  {
    agencyName: "Carsova",
    cash: 72450,
    credit: 50000,
    agencyId: "oqQmsZoUo",
    cars: [
      {
        brand: "bmw",
        models: [
          {
            name: "7",
            year: 1999,
            price: 24700,
            carNumber: "sZrjp",
            ownerId: "oqQmsZoUo",
          },
          {
            name: "3",
            year: 2008,
            price: 54000,
            carNumber: "da88K",
            ownerId: "oqQmsZoUo",
          },
        ],
      },
      {
        brand: "toyota",
        models: [
          {
            name: "Prius",
            year: 2019,
            price: 124050,
            carNumber: "ZfbqH",
            ownerId: "oqQmsZoUo",
          },
          {
            name: "Hilux",
            year: 1996,
            price: 11540,
            carNumber: "AZJZ4",
            ownerId: "oqQmsZoUo",
          },
        ],
      },
    ],
  },
]

// customers---------------------------------------------------------------------------------------------------------------

const customers = [
  {
    name: "Lilah Goulding",
    id: "BGzHhjnE8",
    cars: [
      {
        name: "Corolla",
        year: 2013,
        price: 40570,
        carNumber: "16da1",
        ownerId: "BGzHhjnE8",
      },
    ],
    cash: 35000,
  },
  {
    name: "Ravi Murillo",
    id: "2RprZ1dbL",
    cars: [
      {
        name: "M5",
        year: 2019,
        price: 578054,
        carNumber: "WIh0U",
        ownerId: "2RprZ1dbL",
      },
      {
        name: "Spider",
        year: 2012,
        price: 81520,
        carNumber: "RLS4q",
        ownerId: "2RprZ1dbL",
      },
    ],
    cash: 278542,
  },
  {
    name: "Aleksander Carr",
    id: "pAuFtn_WA",
    cars: [
      {
        name: "Highlander",
        year: 2018,
        price: 214503,
        carNumber: "2WU_y",
        ownerId: "pAuFtn_WA",
      },
    ],
    cash: 125402,
  },
  {
    name: "Lana Edge",
    id: "cnTobUDy6",
    cars: [
      {
        name: "F250",
        year: 2020,
        price: 198500,
        carNumber: "Xxcy_",
        ownerId: "cnTobUDy6",
      },
      {
        name: "Hilux",
        year: 2005,
        price: 35005,
        carNumber: "VSCUj",
        ownerId: "cnTobUDy6",
      },
    ],
    cash: 7000,
  },
  {
    name: "Nikita Philip",
    id: "5x2tMcX4R",
    cars: [
      {
        name: "Impala",
        year: 2016,
        price: 65042,
        carNumber: "LKInp",
        ownerId: "5x2tMcX4R",
      },
    ],
    cash: 40541,
  },
  {
    name: "Bob Steel",
    id: "Wm6BkA1F0",
    cars: [],
    cash: 15732,
  },
  {
    name: "Will Reyes",
    id: "FQvNsEwLZ",
    cars: [
      { name: "X6", year: 2020, price: 966500, ownerId: "FQvNsEwLZ" },
      {
        name: "Land Cruiser",
        year: 2020,
        price: 336300,
        carNumber: "vaJvd",
        ownerId: "FQvNsEwLZ",
      },
      {
        name: "Romeo Julia",
        year: 2020,
        price: 275406,
        carNumber: "qLoYR",
        ownerId: "FQvNsEwLZ",
      },
      {
        name: "Explorer",
        year: 2020,
        price: 265200,
        carNumber: "tlGRq",
        ownerId: "FQvNsEwLZ",
      },
    ],
    cash: 1547242,
  },
]

// taxesAuthority---------------------------------------------------------------------------------------------------------


const taxesAuthority = {
  totalTaxesPaid: 0,
  sumOfAllTransactions: 0,
  numberOfTransactions: 0,
};


// 1. Agency Operations:--------------------------------------------------------------------------------------------



getAgencyByName = (name) => {
  const foundAgency = agencies.find((agency) => agency.agencyName === name);
  return foundAgency || null;
};

getAgencyById = (id) => {
  const foundAgency = agencies.find((agency) => agency.agencyId === id);
  return foundAgency || null;
};

const agencyByName = getAgencyByName("CarMax");
const agencyById = getAgencyById("Plyq5M5AZ");
console.log(agencyByName);
console.log(agencyById);

const getAllAgenciesNames = function () {
  const agencyNames = agencies.map((agency) => agency.agencyName);
  return agencyNames;
};

const allAgencyNames = getAllAgenciesNames();
console.log(allAgencyNames);

setNewCarToAgency = function (agencyId, carObject) {
  const agencyIndex = agencies.findIndex((agency) => agency.agencyId === agencyId);
  
  if (agencyIndex !== -1) {
    agencies[agencyIndex].cars.push(carObject);
    return true;
  } else {
    return false;
  }
};

const newCar = {
  brand: "Toyota",
  models: [
    {
      name: "Camry",
      year: 2022,
      price: 30000,
      carNumber: "ABC123",
      ownerId: null,
    },
  ],
};

const agencyId = "Plyq5M5AZ";
const isCarAdded = setNewCarToAgency(agencyId, newCar);

if (isCarAdded) {
  console.log("New car added to the agency's inventory!");
} else {
  console.log("Agency with the given ID not found!");
}

function removeCarFromInventory(agencyName, carNumber) {
  const agency = agencies.find((agency) => agency.agencyName === agencyName);

  if (agency) {
    const carIndex = agency.cars.findIndex((car) => car.models.some((model) => model.carNumber === carNumber));

    if (carIndex !== -1) {
      agency.cars.splice(carIndex, 1);
      console.log(`Car with carNumber ${carNumber} has been removed from ${agencyName}'s inventory.`);
    } else {
      console.log(`Car with carNumber ${carNumber} not found in ${agencyName}'s inventory.`);
    }
  } else {
    console.log(`Agency with name ${agencyName} not found.`);
  }
}

removeCarFromInventory("Best Deal", "MWXBG");

decrementOrIncrementCashOfAgency = function (agencyId, amount) {
  const agency = agencies.find((agency) => agency.agencyId === agencyId);

  if (agency) {
    agency.cash += amount;
    return agency.cash;
  } else {
    return null;
  }
};

decrementOrIncrementCreditOfAgency = function (agencyId, amount) {
  const agency = agencies.find((agency) => agency.agencyId === agencyId);

  if (agency) {
    agency.credit += amount;
    return agency.credit;
  } else {
    return null;
  }
};

const agencyId1 = "Plyq5M5AZ";
const cashChangeAmount = 50000;
const creditChangeAmount = -200000;

const newCash = decrementOrIncrementCashOfAgency(agencyId1, cashChangeAmount);
const newCredit = decrementOrIncrementCreditOfAgency(agencyId1, creditChangeAmount);

if (newCash !== null) {
  console.log(`New cash balance of agency with ID ${agencyId1}: ${newCash}`);
} else {
  console.log("Agency with the given ID not found!");
}

if (newCredit !== null) {
  console.log(`New credit balance of agency with ID ${agencyId1}: ${newCredit}`);
} else {
  console.log("Agency with the given ID not found!");
}

function updateCarPrice(agencyName, carBrand, carModelName, newPrice) {
  const agency = agencies.find((agency) => agency.agencyName === agencyName);

  if (!agency) {
    console.log("Agency not found.");
    return;
  }

  const carToUpdate = agency.cars.find(
    (car) => car.brand === carBrand && car.models.some((model) => model.name === carModelName)
  );

  if (!carToUpdate) {
    console.log("Car not found in the agency.");
    return;
  }

  const modelToUpdate = carToUpdate.models.find((model) => model.name === carModelName);
  modelToUpdate.price = newPrice;
  console.log(`Price updated successfully: ${agencyName}, ${carBrand}, ${carModelName}, New Price: ${newPrice}`);
}

updateCarPrice("CarMax", "bmw", "X5", 225000);

function getTotalAgencyRevenue(agencies, agencyId) {
  const agency = agencies.find((agency) => agency.agencyId === agencyId);

  if (!agency) {
    return 0;
  }

  let totalRevenue = 0;

  agency.cars.forEach((car) => {
    car.models.forEach((model) => {
      totalRevenue += model.price;
    });
  });

  return totalRevenue;
}

const agencyIdToCheck = "Plyq5M5AZ";
const totalRevenueForAgency = getTotalAgencyRevenue(agencies, agencyIdToCheck);
console.log("Total Revenue for Agency:", totalRevenueForAgency);

function transferCarBetweenAgencies(carName, sourceAgencyName, destinationAgencyName) {
  const sourceAgency = agencies.find((agency) => agency.agencyName === sourceAgencyName);
  const destinationAgency = agencies.find((agency) => agency.agencyName === destinationAgencyName);

  if (!sourceAgency || !destinationAgency) {
    console.log("Source agency or destination agency not found.");
    return;
  }

  const carToTransfer = sourceAgency.cars.find((car) => {
    const foundModel = car.models.find((model) => model.name === carName);
    return foundModel;
  });

  if (!carToTransfer) {
    console.log(`Car with name "${carName}" not found in ${sourceAgencyName}.`);
    return;
  }

  const sourceCarIndex = sourceAgency.cars.findIndex((car) => car === carToTransfer);
  sourceAgency.cars.splice(sourceCarIndex, 1);

  carToTransfer.models.forEach((model) => {
    model.ownerId = destinationAgency.agencyId;
  });

  destinationAgency.cars.push(carToTransfer);

  console.log(`Car "${carName}" transferred from ${sourceAgencyName} to ${destinationAgencyName}.`);
}

transferCarBetweenAgencies("X6", "Best Deal", "CarMax");

const searchCustomer = function (nameOrId) {
  const customerById = customers.find((customer) => customer.id === nameOrId);
  const customerByName = customers.find((customer) => customer.name.toLowerCase() === nameOrId.toLowerCase());
  return customerById || customerByName || null;
};

const searchNameOrId = "BGzHhjnE8";
const foundCustomer = searchCustomer(searchNameOrId);

if (foundCustomer) {
  console.log("Customer found:", foundCustomer);
} else {
  console.log("Customer not found.");
}

const getAllCustomersNames = function () {
  const customerNames = customers.map((customer) => customer.name);
  return customerNames;
};

const allCustomersNames = getAllCustomersNames();
console.log(allCustomersNames);

const changeCustomerCash = function (customerId, newCash) {
  const customer = customers.find((customer) => customer.id === customerId);

  if (customer) {
    customer.cash = newCash;
    return true;
  }
  return false;
};

const customerId = "BGzHhjnE8";
const newCashAmount = 40000;
const isCashChanged = changeCustomerCash(customerId, newCashAmount);

if (isCashChanged) {
  console.log("Customer's cash was successfully updated.");
} else {
  console.log("Customer with the provided ID was not found.");
}

const getCustomerTotalCarValue = function (customerId) {
  const customer = customers.find((customer) => customer.id === customerId);
  if (customer) {
    return customer.cars.reduce((totalValue, car) => totalValue + car.price, 0);
  }
  return 0;
};

const customerId1 = "2RprZ1dbL";
const totalCarValue = getCustomerTotalCarValue(customerId1);
console.log(`Total value of all cars owned by the customer: $${totalCarValue}`);

const getAllCarsToBuy = function () {
  const allCarsToBuy = [];

  agencies.forEach((agency) => {
    agency.cars.forEach((carData) => {
      carData.models.forEach((carModel) => {
        allCarsToBuy.push({
          brand: carData.brand,
          name: carModel.name,
          year: carModel.year,
          price: carModel.price,
          carNumber: carModel.carNumber,
          ownerId: carModel.ownerId,
        });
      });
    });
  });

  return allCarsToBuy;
};

const allAvailableCars = getAllCarsToBuy();
console.log(allAvailableCars);

function searchCarsByCriteria(agencies, productionYear, maxPrice, brand) {
  const matchingCars = [];

  for (const agency of agencies) {
    for (const car of agency.cars) {
      for (const model of car.models) {
        if (
          model.year === productionYear &&
          model.price <= maxPrice &&
          car.brand.toLowerCase() === brand.toLowerCase()
        ) {
          matchingCars.push({
            agencyName: agency.agencyName,
            carBrand: brand,
            carModel: model.name,
            carYear: model.year,
            carPrice: model.price,
          });
        }
      }
    }
  }
  return matchingCars;
}

const matchingCars = searchCarsByCriteria(agencies, 2019, 150000, "Toyota");
console.log(matchingCars);

function getMostExpensiveCar(agencies) {
  let mostExpensiveCar = null;
  let maxPrice = 0;

  for (const agency of agencies) {
    for (const car of agency.cars) {
      for (const model of car.models) {
        if (model.price > maxPrice) {
          maxPrice = model.price;
          mostExpensiveCar = model;
        }
      }
    }
  }

  return mostExpensiveCar;
}

const mostExpensiveCar = getMostExpensiveCar(agencies);
console.log(mostExpensiveCar);

function getCheapestCar(agencies) {
  let cheapestCar = null;
  let minPrice = Number.MAX_VALUE;

  for (const agency of agencies) {
    for (const car of agency.cars) {
      for (const model of car.models) {
        if (model.price < minPrice) {
          minPrice = model.price;
          cheapestCar = model;
        }
      }
    }
  }

  return cheapestCar;
}

const cheapestCar = getCheapestCar(agencies);
console.log(cheapestCar);

function sellCar(customerId, carNumber, agencyId) {
  const customer = customers.find((c) => c.id === customerId);
  const agency = agencies.find((a) => a.agencyId === agencyId);

  if (!customer || !agency) {
    console.log("Customer or agency not found.");
    return;
  }

  let carToSell = null;
  let carModelIndex = -1;
  let carBrandIndex = -1;

  for (let i = 0; i < agency.cars.length; i++) {
    const brand = agency.cars[i];
    const modelIndex = brand.models.findIndex((model) => model.carNumber === carNumber);

    if (modelIndex !== -1) {
      carBrandIndex = i;
      carModelIndex = modelIndex;
      carToSell = brand.models[modelIndex];
      break;
    }
  }

  if (!carToSell) {
    console.log("Car not found at the agency.");
    return;
  }

  if (customer.cash < carToSell.price) {
    console.log("Customer does not have enough cash to purchase the car.");
    return;
  }

  customer.cash -= carToSell.price;
  agency.cash += carToSell.price;

  agency.cars[carBrandIndex].models.splice(carModelIndex, 1);

  console.log(`Car with carNumber "${carNumber}" has been sold to ${customer.name}.`);
}

sellCar(customerId2, carNumber, agencyId2);

function getTotalMarketRevenue() {
  let totalRevenue = 0;

  for (const agency of agencies) {
    for (const carBrandData of agency.cars) {
      for (const model of carBrandData.models) {
        totalRevenue += model.price;
      }
    }
  }

  return totalRevenue;
}

const totalMarketRevenue = getTotalMarketRevenue();
console.log("Total market revenue: $" + totalMarketRevenue);
